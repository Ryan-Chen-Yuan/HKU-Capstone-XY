# 知己报告命令功能使用说明

## 📋 功能简介

在对话中，用户可以通过发送特定命令来触发智能分析报告生成。系统将基于用户的对话历史、事件记录、情绪数据等信息，自动生成个性化的心理健康分析报告。

## 🎯 支持的命令

用户可以使用以下任意命令来触发报告生成：

### 基础命令
- `知己报告`
- `生成报告`
- `我的报告`
- `心理分析报告`
- `分析报告`
- `知己分析报告`
- `知己报告生成`

### 自然语言表达
- `我想要知己报告`
- `请给我知己报告`
- `能生成我的分析报告吗`
- `知己报告请帮我生成`
- `请为我生成心理分析报告`

## 📊 报告内容

生成的报告包含以下几个部分：

### 1. 数据概览
- 分析的对话会话数量
- 识别的重要事件数量
- 记录的情绪状态次数
- 分析时间范围

### 2. 情绪画像
- 平均情绪强度评分（1-10分）
- 主要情绪状态分布
- 情绪变化趋势

### 3. 事件分析
- 事件类型分类统计
  - 情绪相关事件
  - 行为模式事件
  - 生理状态事件
  - 认知思维事件
  - 人际关系事件
  - 生活事件

### 4. AI智能分析
- 整体心理健康状态评估
- 风险等级评估
- 发展趋势分析
- 主要发现和洞察
- 个性化建议和推荐

## 🔧 使用方法

### 方法1：直接对话
在与AI助手的对话中，直接发送命令：
```
用户: 知己报告
AI: 📊 **您的知己分析报告** 📊
    
    📈 **数据概览**
    • 分析了 3 次对话会话
    • 识别了 8 个重要事件
    • 记录了 15 次情绪状态
    
    💭 **情绪画像**
    • 平均情绪强度: 4.2/10
    • 主要情绪状态: 焦虑 (8次)
    
    🎯 **事件分析**
    • 情绪相关: 5个事件
    • 行为模式: 2个事件
    • 生理状态: 1个事件
    
    🤖 **AI智能分析**
    • 整体状态: 轻度焦虑，需要关注
    • 风险等级: 中等
    • 发展趋势: 情绪波动，需要干预
    
    💡 **即时建议**
    • 建议进行深呼吸练习
    • 考虑调整作息时间
    
    ---
    💝 这是基于我们对话历史生成的个性化分析报告。
    如需详细报告或有任何疑问，请随时告诉我！
```

### 方法2：API调用
通过HTTP API发送聊天请求：
```bash
curl -X POST http://localhost:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "your_user_id",
    "session_id": "your_session_id",
    "message": "知己报告",
    "timestamp": "2024-01-01T12:00:00Z"
  }'
```

API响应会包含额外的报告元数据：
```json
{
  "message_id": "msg_12345678",
  "content": "📊 **您的知己分析报告** 📊...",
  "emotion": "neutral",
  "timestamp": "2024-01-01T12:00:00Z",
  "session_id": "your_session_id",
  "report_generated": true,
  "report_summary": {
    "sessions_analyzed": 3,
    "total_events": 8,
    "emotion_records": 15,
    "analysis_period_days": 30
  }
}
```

## 📋 前置条件

为了生成有意义的报告，用户需要：

1. **有对话历史**：至少进行过几次对话
2. **有事件记录**：系统已自动提取并记录了相关事件
3. **有情绪数据**：系统已记录了情绪状态信息
4. **有用户画像**：系统已建立了基本的用户档案

## ⚠️ 注意事项

### 数据要求
- 如果用户没有足够的对话历史，系统会提示用户多进行一些对话
- 如果无法识别用户身份，系统会要求用户先进行登录或对话

### 生成限制
- 报告生成可能需要几秒钟时间
- 如果AI分析服务不可用，系统会自动切换到备用分析方案
- 频繁请求可能会遇到速率限制

### 隐私保护
- 报告仅包含用户自己的数据
- 所有个人信息都经过适当处理
- 报告内容仅在当前会话中显示

## 🔧 技术实现

### 命令检测
系统使用模式匹配来识别知己报告命令：
```python
def _detect_report_command(message):
    command_variations = [
        "知己报告", "知己分析报告", "生成报告", "我的报告", 
        "心理分析报告", "分析报告", "知己报告生成"
    ]
    message_clean = message.strip().lower()
    return any(cmd.lower() in message_clean for cmd in command_variations)
```

### 报告生成流程
1. 检测命令触发
2. 验证用户身份
3. 收集用户数据（对话、事件、情绪、画像）
4. 调用分析服务生成报告
5. 格式化报告内容
6. 返回用户友好的报告摘要

### 错误处理
- 用户身份验证失败：提示用户进行对话
- 数据不足：引导用户进行更多交互
- 服务异常：提供友好的错误提示
- AI分析失败：自动切换到备用分析方案

## 🚀 扩展功能

### 未来规划
- 支持语音命令触发报告生成
- 增加报告导出功能（PDF、邮件等）
- 支持定期自动生成报告
- 增加报告分享功能（匿名化处理）
- 支持多语言报告生成

### 自定义选项
- 报告时间范围选择（7天、30天、90天）
- 报告详细程度选择（简要、详细、完整）
- 特定维度分析（只分析情绪、只分析事件等）

## 📞 技术支持

如果遇到问题，请：
1. 检查是否有足够的对话历史
2. 确认用户身份识别正常
3. 查看服务器日志获取详细错误信息
4. 联系技术支持团队

---

## 测试验证

系统已通过全面测试，包括：
- ✅ 命令识别测试（8种表达方式）
- ✅ 报告生成测试（完整流程）
- ✅ 边界情况测试（无效命令、数据不足等）
- ✅ 错误处理测试（API限制、服务异常等）
- ✅ 数据统计准确性测试

用户现在可以放心使用"知己报告"功能获取个性化的心理健康分析报告！ 