# 青少年心理对话服务微信小程序设计文档

## AI对话+测评功能设计

### 1. 功能概述

本微信小程序旨在为青少年提供心理对话服务，通过AI虚拟倾诉师与用户进行对话，并提供情绪分析、事件提取和解决方案建议等功能。核心模块为"AI对话+测评"，该模块通过多次调用先进的大语言模型(LLM)，实现智能对话、情感分析、事件提取和解决方案推荐，并记录用户的认知成长历程。

### 2. 用户交互体验设计

#### 2.1 整体界面风格

界面设计秉承简洁而强大的理念，采用温暖、舒适的色调，创造安全感和信任感。主要色调建议使用柔和的蓝色和绿色，这些颜色在心理学上被认为具有安抚和治愈的效果。字体选择清晰易读，界面元素布局符合微信小程序的设计规范，确保用户操作直观自然。

#### 2.2 用户交互流程

1. **初次使用引导**
   
   用户首次进入小程序时，会看到简短的引导页面，介绍小程序的功能和使用方法。引导页面设计为轻松友好的插图风格，通过3-4个页面简明扼要地展示核心功能，最后一页包含"开始对话"按钮。

2. **主对话界面**
   
   主对话界面采用类似聊天软件的布局，但增加了情感分析和建议卡片的展示区域。界面从上到下分为以下几个部分：
   
   - 顶部导航栏：显示"心理对话"标题，右侧有设置按钮
   - 中部对话区域：占据屏幕主要空间，显示用户与AI倾诉师的对话内容
   - 底部输入区：文本输入框和发送按钮，可支持语音输入
   - 浮动功能区：可展开的情绪分析、事件提取和解决方案卡片

3. **对话交互**
   
   用户可以通过文本或语音向AI倾诉师描述自己的问题和感受。AI倾诉师的回复会以气泡形式显示在对话区域，回复内容包括情绪肯定和初步建议。

4. **测评结果展示**
   
   当AI完成分析后，系统会在对话区域下方显示一个可展开的卡片，包含三个标签页：
   
   - 情绪分析：显示检测到的情绪类别和强度，使用简单的图表可视化
   - 事件提取：列出AI从对话中提取的关键事件和问题
   - 解决方案：提供针对性的建议和方案

   用户可以点击标签页查看详细内容，每个分析结果旁边都有"采纳"按钮，用户可以选择是否采纳这些分析结果。

5. **认知成长奖励**
   
   当系统检测到用户在对话过程中有认知成长或新的理解时，会弹出一个精心设计的勋章奖励动画，并简要说明获得勋章的原因。动画设计为轻量级，不打断用户的对话体验，但足够吸引注意力以提供正向反馈。

6. **历史记录查看**
   
   用户可以通过主界面的入口进入历史记录页面，查看过去的对话内容、采纳的分析结果和获得的勋章。历史记录按时间倒序排列，支持按日期筛选。

#### 2.3 交互细节设计

1. **输入反馈**
   
   - 当用户正在输入时，AI倾诉师头像下方会显示"正在输入..."的提示
   - 发送消息后，有简短的发送动画确认消息已发出
   - AI回复时，显示"思考中..."的动态效果，增强拟人化体验

2. **情绪分析展示**
   
   - 情绪分析结果使用色彩编码：积极情绪用绿色，消极情绪用红色，中性情绪用灰色
   - 情绪强度通过色彩深浅或进度条直观显示
   - 主要情绪和次要情绪分别标识，并提供简短解释

3. **事件提取展示**
   
   - 提取的事件以时间线或列表形式展示
   - 每个事件可展开查看详情
   - 事件按重要性排序，重要事件视觉上更突出

4. **解决方案展示**
   
   - 解决方案分为短期和长期两类
   - 每个方案包含具体步骤和预期效果
   - 提供"已尝试"和"有效果"的反馈选项

5. **采纳机制**
   
   - 用户点击"采纳"按钮后，该项分析结果会被高亮标记
   - 系统记录采纳时间和内容
   - 采纳后的内容会自动同步到个人主页的相关板块

6. **勋章奖励机制**
   
   - 勋章设计为简约而有意义的图标
   - 获得勋章时有轻微的声音和视觉反馈
   - 勋章附带简短的成长说明，如"发现了新的思考角度"

### 3. 对话流程图

```
用户 -> 输入问题/感受 -> AI倾诉师
AI倾诉师 -> LLM处理(对话生成) -> 回复用户(情绪肯定+初步建议)
                 |
                 v
          LLM处理(情绪分析)
                 |
                 v
          LLM处理(事件提取)
                 |
                 v
          LLM处理(解决方案生成)
                 |
                 v
          LLM处理(认知变化检测)
                 |
                 v
系统 -> 展示分析结果(情绪/事件/方案) -> 用户
用户 -> 选择是否采纳分析结果 -> 系统记录
系统 -> 检测到认知成长 -> 颁发勋章 -> 用户
```

### 4. LLM调用设计

#### 4.1 LLM调用流程

AI对话+测评功能涉及多次LLM调用，每次调用针对不同的任务。主要调用流程如下：

1. **对话生成调用**
   - 输入：用户的问题/感受 + 对话历史 + 角色设定
   - 输出：AI倾诉师的回复（包含情绪肯定和初步建议）
   - 调用时机：用户发送消息后立即调用

2. **情绪分析调用**
   - 输入：用户的问题/感受 + 对话历史
   - 输出：情绪类别、强度和解释
   - 调用时机：对话生成完成后异步调用

3. **事件提取调用**
   - 输入：用户的问题/感受 + 对话历史
   - 输出：关键事件列表及其重要性评分
   - 调用时机：对话生成完成后异步调用

4. **解决方案生成调用**
   - 输入：用户的问题/感受 + 对话历史 + 情绪分析结果 + 事件提取结果
   - 输出：短期和长期解决方案建议
   - 调用时机：情绪分析和事件提取完成后调用

5. **认知变化检测调用**
   - 输入：用户的问题/感受 + 完整对话历史 + 用户过往认知模式
   - 输出：是否存在认知变化、变化类型和描述
   - 调用时机：解决方案生成完成后调用

#### 4.2 数据结构设计

为了有效承载LLM的调用结果，设计以下数据结构：

1. **对话消息结构**
```json
{
  "messageId": "唯一标识符",
  "timestamp": "时间戳",
  "sender": "user/ai",
  "content": "消息内容",
  "contentType": "text/voice",
  "emotionResponse": "情绪肯定内容(仅AI消息有)",
  "initialSuggestion": "初步建议内容(仅AI消息有)"
}
```

2. **情绪分析结构**
```json
{
  "analysisId": "唯一标识符",
  "messageId": "关联的消息ID",
  "timestamp": "分析时间戳",
  "primaryEmotion": {
    "type": "情绪类型",
    "intensity": "强度(0-100)",
    "description": "描述"
  },
  "secondaryEmotions": [
    {
      "type": "情绪类型",
      "intensity": "强度(0-100)",
      "description": "描述"
    }
  ],
  "adopted": "是否被用户采纳",
  "adoptedTimestamp": "采纳时间戳"
}
```

3. **事件提取结构**
```json
{
  "extractionId": "唯一标识符",
  "messageId": "关联的消息ID",
  "timestamp": "提取时间戳",
  "events": [
    {
      "eventId": "事件唯一标识符",
      "description": "事件描述",
      "importance": "重要性(0-100)",
      "relatedEmotions": ["相关情绪"],
      "timeContext": "事件发生的时间上下文"
    }
  ],
  "adopted": "是否被用户采纳",
  "adoptedTimestamp": "采纳时间戳"
}
```

4. **解决方案结构**
```json
{
  "solutionId": "唯一标识符",
  "messageId": "关联的消息ID",
  "timestamp": "生成时间戳",
  "shortTermSolutions": [
    {
      "solutionId": "方案唯一标识符",
      "title": "方案标题",
      "description": "方案描述",
      "steps": ["具体步骤"],
      "expectedOutcome": "预期效果"
    }
  ],
  "longTermSolutions": [
    {
      "solutionId": "方案唯一标识符",
      "title": "方案标题",
      "description": "方案描述",
      "steps": ["具体步骤"],
      "expectedOutcome": "预期效果"
    }
  ],
  "adopted": "是否被用户采纳",
  "adoptedTimestamp": "采纳时间戳",
  "feedback": {
    "tried": "是否尝试",
    "effective": "是否有效"
  }
}
```

5. **认知变化结构**
```json
{
  "changeId": "唯一标识符",
  "messageId": "关联的消息ID",
  "timestamp": "检测时间戳",
  "changeDetected": "是否检测到变化",
  "changeType": "变化类型(新视角/自我认知/问题理解等)",
  "description": "变化描述",
  "previousState": "先前的认知状态",
  "currentState": "当前的认知状态",
  "medalAwarded": "是否颁发勋章",
  "medalType": "勋章类型",
  "medalDescription": "勋章描述"
}
```

6. **会话结构**
```json
{
  "sessionId": "会话唯一标识符",
  "userId": "用户ID",
  "startTime": "开始时间戳",
  "endTime": "结束时间戳",
  "messages": ["消息ID列表"],
  "emotionAnalyses": ["情绪分析ID列表"],
  "eventExtractions": ["事件提取ID列表"],
  "solutions": ["解决方案ID列表"],
  "cognitiveChanges": ["认知变化ID列表"]
}
```

### 5. 情绪分析和事件提取设计

#### 5.1 情绪分析机制

情绪分析模块通过LLM分析用户的语言表达，识别其中包含的情绪类型和强度。主要设计如下：

1. **情绪类别分类**
   
   系统将情绪分为以下几类：
   - 积极情绪：快乐、满足、希望、自豪、感激等
   - 消极情绪：悲伤、愤怒、焦虑、恐惧、失望、内疚等
   - 中性情绪：困惑、好奇、平静等
   - 复杂情绪：矛盾、怀旧、敬畏等

2. **情绪强度评估**
   
   对每种检测到的情绪，系统会评估其强度（0-100分），并提供直观的可视化表示。

3. **情绪变化追踪**
   
   系统会记录用户在不同对话中的情绪变化，形成情绪趋势图，帮助用户了解自己的情绪变化轨迹。

4. **情绪肯定机制**
   
   AI倾诉师会根据检测到的情绪，提供适当的情绪肯定，表达理解和接纳，例如：
   - 对于悲伤情绪："我能感受到你的难过，这种感受是完全可以理解的。"
   - 对于愤怒情绪："你的愤怒是有原因的，这是对不公平情况的自然反应。"

#### 5.2 事件提取机制

事件提取模块从用户的叙述中识别关键事件和问题，帮助用户客观看待自己的处境。主要设计如下：

1. **事件识别标准**
   
   系统会根据以下标准识别关键事件：
   - 用户反复提及的情境
   - 引发强烈情绪反应的经历
   - 包含人际冲突的场景
   - 涉及重要决策的情况
   - 与用户核心价值观相关的经历

2. **事件重要性评分**
   
   对每个提取的事件，系统会评估其重要性（0-100分），考虑因素包括：
   - 事件对用户情绪的影响程度
   - 事件在用户叙述中的出现频率
   - 事件与用户核心问题的相关性
   - 事件的时间紧迫性

3. **事件关联分析**
   
   系统会分析不同事件之间的关联，识别潜在的因果关系或模式，帮助用户看到更大的图景。

4. **事件时间线构建**
   
   对于复杂问题，系统会构建事件时间线，帮助用户理清事件发展脉络。

### 6. 解决方案建议机制

解决方案建议模块基于情绪分析和事件提取的结果，为用户提供针对性的建议和方案。主要设计如下：

1. **方案生成原则**
   
   系统生成解决方案时遵循以下原则：
   - 针对性：直接针对用户的核心问题和需求
   - 可行性：考虑用户的实际情况和资源
   - 分阶段：区分短期和长期解决方案
   - 多样性：提供不同角度和方法的建议
   - 支持性：强调用户的能力和资源

2. **短期解决方案**
   
   短期解决方案侧重于：
   - 情绪调节技巧
   - 立即可采取的小步骤
   - 缓解当前压力的方法
   - 改善当前状况的具体行动

3. **长期解决方案**
   
   长期解决方案侧重于：
   - 根本问题的解决途径
   - 能力和资源的培养
   - 认知模式的调整
   - 生活方式的改变

4. **方案反馈机制**
   
   用户可以对解决方案提供反馈：
   - 标记已尝试的方案
   - 评价方案的有效性
   - 记录实施方案的困难和收获

### 7. 认知成长奖励系统

认知成长奖励系统旨在鼓励用户在心理成长过程中的积极变化和新的认知发现。主要设计如下：

1. **认知变化检测标准**
   
   系统会检测以下类型的认知变化：
   - 自我认知的新发现（如性格特质、能力、价值观）
   - 问题理解的新角度
   - 思维模式的转变
   - 情绪觉察能力的提升
   - 人际关系理解的深化

2. **勋章类型设计**
   
   设计多种类型的勋章，对应不同的认知成长：
   - "新视角"勋章：发现问题的新角度
   - "自我发现"勋章：认识到新的自我特质
   - "情绪智慧"勋章：提升情绪觉察和管理能力
   - "关系洞察"勋章：深化对人际关系的理解
   - "成长思维"勋章：从固定思维转向成长思维

3. **勋章展示机制**
   
   - 勋章会在用户个人主页中展示
   - 每个勋章附带获得时间和相关事件描述
   - 勋章可以组成成长轨迹图，直观展示用户的心理成长历程

4. **成长记录功能**
   
   系统会记录用户的认知成长历程，包括：
   - 重要的认知突破
   - 情绪管理能力的提升
   - 问题解决能力的增强
   - 人际关系的改善

### 8. 技术实现考虑

1. **LLM选择与调用**
   
   建议使用以下LLM选项：
   - 对话生成：GPT-4或同等级别的模型，确保自然流畅的对话体验
   - 情绪分析：专门训练过情绪识别的模型或微调版本
   - 事件提取和解决方案生成：具备强大推理能力的大模型

2. **提示词设计**
   
   为不同的LLM调用设计专门的提示词模板，确保输出符合预期格式。例如：
   - 情绪分析提示词：明确要求输出情绪类别、强度和描述
   - 事件提取提示词：指导模型识别关键事件并评估重要性
   - 解决方案生成提示词：要求区分短期和长期方案，并提供具体步骤

3. **数据安全与隐私**
   
   考虑以下数据安全措施：
   - 用户数据加密存储
   - 明确的隐私政策和数据使用说明
   - 提供数据删除选项
   - 遵循相关法规要求

4. **性能优化**
   
   为提升用户体验，考虑以下优化：
   - 对话生成优先处理，确保及时响应
   - 其他分析任务异步处理，不阻塞主对话流程
   - 使用缓存机制减少重复计算
   - 针对微信小程序环境优化界面渲染

### 9. 未来扩展考虑

1. **多模态输入支持**
   
   未来可考虑支持以下输入方式：
   - 语音情绪分析
   - 图片分享和分析
   - 日记形式的长文本输入

2. **社区支持功能**
   
   可考虑增加以下社区功能：
   - 匿名心理支持社区
   - 专业心理咨询师在线咨询
   - 心理健康知识库

3. **个性化推荐系统**
   
   基于用户的对话历史和问题类型，提供个性化的：
   - 心理健康文章推荐
   - 适合的心理练习
   - 相关书籍和资源

4. **与专业心理服务的衔接**
   
   当检测到用户可能需要专业帮助时，提供：
   - 专业心理咨询资源推荐
   - 危机干预热线信息
   - 转介服务指导
