<view class="container">
  <!-- 自定义导航栏 -->
  <view class="custom-nav">
    <view class="nav-content">
      <view class="nav-left">
        <view class="menu-button" bindtap="toggleSidebar">
          <view class="menu-icon"></view>
          <view class="menu-icon"></view>
          <view class="menu-icon"></view>
        </view>
        <view class="new-chat-button-small" bindtap="startNewChat">
          <text class="new-chat-icon">+</text>
        </view>
      </view>
      <view class="nav-title">知己AI助手</view>
    </view>
  </view>

  <!-- 侧边栏背景遮罩 -->
  <view class="sidebar-backdrop {{showSidebar ? 'show' : ''}}" bindtap="closeSidebar"></view>

  <!-- 侧边栏 -->
  <view class="sidebar {{showSidebar ? 'open' : ''}}">
    <view class="sidebar-header">
      <view class="sidebar-title">聊天记录</view>
    </view>
    <scroll-view class="history-list" scroll-y>
      <view class="history-item" wx:for="{{chatHistory}}" wx:key="id" bindtap="loadChat" data-id="{{item.id}}" bindlongpress="deleteChat" data-id="{{item.id}}">
        <view class="history-title">{{item.title}}</view>
        <view class="history-time">{{item.time}}</view>
      </view>
    </scroll-view>
    <view class="sidebar-footer" bindtap="navigateToProfile">
      <view class="profile-icon">
        <image class="profile-image" src="https://mmbiz.qpic.cn/mmbiz_png/UicQ7HgWiaUb0Z1V9YjBZXHg5KwXZbP3ZrPdvXt7GWoibqzfRMvR3yPmkjGR8yNIib3ib3uOBZqyaYNw7yNjRQUuiciaA/0"></image>
      </view>
      <view class="user-info">
        <view class="user-name">点击进入个人中心</view>
      </view>
    </view>
  </view>

  <!-- 主聊天区域 -->
  <view class="main-content {{showSidebar ? 'with-sidebar' : ''}}">
    <view class="chat-container">
      <scroll-view class="chat-list {{messages.length > 0 ? 'has-messages' : ''}}" scroll-y scroll-into-view="{{scrollToMessage}}" scroll-with-animation>
        <!-- 欢迎界面 -->
        <view class="welcome-container" wx:if="{{messages.length === 0}}">
          <view class="welcome-icon">
            <image src="https://mmbiz.qpic.cn/mmbiz_png/UicQ7HgWiaUb0Z1V9YjBZXHg5KwXZbP3Zr5Tz0vIVnhVvDKv7BEa5rF2aVyqr5WwOWicVGVGZibjbVF3VyOLxkTxw/0"></image>
          </view>
          <view class="welcome-title">欢迎使用知己AI助手</view>
          <view class="welcome-subtitle">人生知己，知己知彼。我是您的智能助手，可以帮您解答问题、提供建议和完成任务。请随时向我提问！</view>
        </view>
        
        <!-- 消息列表 -->
        <block wx:for="{{messages}}" wx:key="id">
          <view class="message {{item.type}}-message" id="msg-{{item.id}}">
            <view class="message-content">{{item.content}}</view>
          </view>
        </block>
        
        <!-- 加载动画 -->
        <view class="loading-container" wx:if="{{isLoading}}">
          <view class="loading-dots">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- 输入区域 -->
  <view class="input-wrapper {{messages.length > 0 ? 'bottom' : 'center'}}">
    <view class="input-container">
      <input class="message-input" 
             type="text" 
             value="{{inputMessage}}" 
             bindinput="onInputChange" 
             placeholder="给知己AI助手发送消息" 
             confirm-type="send"
             bindconfirm="sendMessage"
             adjust-position="{{false}}"
             cursor-spacing="20"/>
      <view class="send-button" bindtap="sendMessage">
        <text>发送</text>
      </view>
    </view>
    <view class="ai-disclaimer" wx:if="{{messages.length > 0}}">内容由 AI 生成，仅供参考</view>
  </view>

  <!-- 勋章展示架 -->
  <view class="medal-display {{isDragging ? 'dragging' : ''}}" 
        bindtap="navigateToMedals" 
        bindtouchstart="touchStart"
        bindtouchmove="touchMove"
        bindtouchend="touchEnd"
        style="left: {{medalPosition.x}}px; top: {{medalPosition.y}}px;">
    <view class="medal-container">
      <view class="medal" wx:for="{{medals}}" wx:key="id" wx:if="{{index < 3}}">
        <image class="medal-image" src="{{item.icon}}"></image>
      </view>
    </view>
  </view>
</view> 